{% load widget_tweaks %}

{% block main_content %}

    <div class="row">
        <div class="col">
            <h3>Новая раздача</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-12 col-md-8 form-new-distrib" style="overflow-y: scroll">
            <form>
                <div class="mb-2">
                    <label for="{{ form.factory.id_for_label }}" class="form-label">{{ form.factory.label }}</label>
                    {% render_field form.factory class='form-select' id='fabric' required='true' data-placeholder='Выберите предприятие' %}
                </div>
                <div class="mb-2">
                    <label for="{{ form.distribution_date.id_for_label }}"
                           class="form-label">{{ form.distribution_date.label }}</label>
                    {% render_field form.distribution_date class='form-control' type='date' %}
                </div>
                <div class="row mb-2">
                    <div class="col text-nowrap">
                        <label for="{{ form.start_time.id_for_label }}"
                               class="form-label">{{ form.start_time.label }}</label>
                        {% render_field form.start_time class='form-control mb-2' type='time' %}
                    </div>
                    <div class="col text-nowrap">
                        <label for="{{ form.end_time.id_for_label }}"
                               class="form-label">{{ form.end_time.label }}</label>
                        {% render_field form.end_time class='form-control mb-2' type='time' min='' %}
                    </div>
                </div>
                <div class="mb-2">
                    <label for="party-members" class="form-label">Участники-члены партии</label>
                    <select class="form-select"
                            aria-label="Default select example"
                            id="party-members"
                            name="party-members"
                            data-placeholder='Выберите членов партии'
                            multiple>
                        {% for member in party_members %}
                            <option value="{{ member.pk }}">{{ member.email }} {{ member.get_full_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            <div class="mb-2">
                    <label for="sympathizers" class="form-label">Сочувствующие:</label>
                    <select class="form-select"
                            aria-label="Default select example"
                            id="sympathizers"
                            name="sympathizers"
                            data-placeholder='Выберите или добавьте сочувствующих'
                            multiple>
                        {% for sympathizer in sympathizers %}
                            <option value="{{ sympathizer.pk }}">{{ sympathizer.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            <div class="mb-2">
                <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
                {% render_field form.description class='form-control' rows='3' %}
            </div>
            </form>
        </div>
    </div>
{% endblock %}


{% block scripts %}
    <script>
        $('#fabric').select2({
            theme: "bootstrap-5",
            width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
            placeholder: $(this).data('placeholder'),
        });
        $( '#party-members' ).select2( {
            theme: "bootstrap-5",
            width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
            placeholder: $( this ).data( 'placeholder' ),
            closeOnSelect: false,
        } );
         $( '#sympathizers' ).select2( {
            theme: "bootstrap-5",
            width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
            placeholder: $( this ).data( 'placeholder' ),
            closeOnSelect: false,
            tags: true
        } );

        /*inputs = document.querySelectorAll('.form-new-distrib input, select, textarea')

        for (let i = 0; i < inputs.length; i++) {
            inputs[i].addEventListener('focus', toggleMobileMenu);
            inputs[i].addEventListener('focus', (el) => {console.log(el);});
            inputs[i].addEventListener('focus', (el) => {el.scrollIntoView(false);});
            inputs[i].addEventListener('blur', toggleMobileMenu);
        }*/

    </script>
{% endblock scripts %}