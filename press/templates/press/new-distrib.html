{% load widget_tweaks %}

{% block main_content %}

    <div class="row">
        <div class="col">
            <h3>Новая раздача</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-12 col-md-8 form-new-distrib">
            <form id="new-distrib">
                <div class="mb-2">
                    <label for="{{ form.factory.id_for_label }}" class="form-label">{{ form.factory.label }}</label>
                    {% render_field form.factory class='form-select' id='fabric' required='true' data-placeholder='Выберите предприятие' %}
                </div>
                <div class="mb-2">
                    <label for="{{ form.distribution_date.id_for_label }}"
                           class="form-label">{{ form.distribution_date.label }}</label>
                    {% render_field form.distribution_date class='form-control' type='date' %}
                </div>
                <div class="row mb-2">
                    <div class="col text-nowrap">
                        <label for="{{ form.start_time.id_for_label }}"
                               class="form-label">{{ form.start_time.label }}</label>
                        {% render_field form.start_time class='form-control mb-2' type='time' %}
                    </div>
                    <div class="col text-nowrap">
                        <label for="{{ form.end_time.id_for_label }}"
                               class="form-label">{{ form.end_time.label }}</label>
                        {% render_field form.end_time class='form-control mb-2' type='time' min='' %}
                    </div>
                </div>
                <div class="mb-2" id="party-member-list" hx-validate="true">
                    <label for="party-members" class="form-label">Участники-члены партии:</label>
                </div>
            <button
                    class="mb-2 btn btn-sm btn-secondary"
                    hx-post="{% url 'press:htmx-add-party-member' %}"
                    hx-include="#party-member-list"
                    hx-target="#party-member-list"
                    hx-swap="beforeend"
                    onclick="[].slice.call(document.querySelectorAll('#party-member-list select')).forEach((e) => (e.readonly = true))"
            ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
              <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
              <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
            </svg> Добавить раздающего партийца</button>
                <hr>
            <div class="mb-2" id="sympathizers-member-list">
                    <label for="sympathizers" class="form-label">Сочувствующие:</label>

                </div>
                <button
                            class="mb-2 btn btn-sm btn-secondary"
                            hx-post="{% url 'press:htmx-add-sympathizer' %}"
                            hx-include="#sympathizers-member-list"
                            hx-target="#sympathizers-member-list"
                            hx-swap="beforeend"
                    ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
                      <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                      <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                    </svg> Добавить раздающего сочувствующего</button>
                <hr>
            <div class="mb-2">
                <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
                {% render_field form.description class='form-control' rows='3' %}
            </div>
            </form>
        </div>
    </div>
{% endblock %}


{% block scripts %}
    <script>
        $('#fabric').select2({
            theme: "bootstrap-5",
            width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
            placeholder: $(this).data('placeholder'),
        });
        $( '#party-members' ).select2( {
            theme: "bootstrap-5",
            width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
            placeholder: $( this ).data( 'placeholder' ),
            closeOnSelect: false,
        } );
         $( '#sympathizers' ).select2( {
            theme: "bootstrap-5",
            width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
            placeholder: $( this ).data( 'placeholder' ),
            closeOnSelect: false,
            tags: true
        } );

        /*inputs = document.querySelectorAll('.form-new-distrib input, select, textarea')

        for (let i = 0; i < inputs.length; i++) {
            inputs[i].addEventListener('focus', toggleMobileMenu);
            inputs[i].addEventListener('focus', (el) => {console.log(el);});
            inputs[i].addEventListener('focus', (el) => {el.scrollIntoView(false);});
            inputs[i].addEventListener('blur', toggleMobileMenu);
        }*/

    </script>
{% endblock scripts %}